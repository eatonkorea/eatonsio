<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIO ì ‘ìˆ˜ ì‹œìŠ¤í…œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    .spinner { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
    .pop-in { animation: popIn 0.4s ease-out; }
    @keyframes checkmark { 0% { stroke-dashoffset: 100; } 100% { stroke-dashoffset: 0; } }
    .checkmark-circle { animation: popIn 0.4s ease-out; }
    .checkmark-check { stroke-dasharray: 100; animation: checkmark 0.6s ease-out 0.3s forwards; stroke-dashoffset: 100; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const API_URL = 'https://script.google.com/macros/s/AKfycbwJtHeKUbNMvXC3ZhVUszOEihuH5ypz_9TqJKmdnVkG-xyBFUXtm8Or4KZu17AgK21f_g/exec';

    const convertDriveUrl = (url) => {
      if (!url) return '';
      const match = url.match(/[?&]id=([^&]+)/);
      if (match) return `https://lh3.googleusercontent.com/d/${match[1]}`;
      return url;
    };

    const Icon = ({ name, size = 24, className = "" }) => {
      const ref = React.useRef();
      React.useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          if (className) icon.setAttribute('class', className);
          ref.current.appendChild(icon);
        }
      }, [name, size, className]);
      return <span ref={ref} className="inline-flex items-center justify-center"></span>;
    };

    function SuccessModal({ onClose }) {
      React.useEffect(() => { const timer = setTimeout(onClose, 2500); return () => clearTimeout(timer); }, [onClose]);
      return (
        <div className="fixed inset-0 bg-green-500 flex flex-col items-center justify-center z-50" onClick={onClose}>
          <div className="pop-in flex flex-col items-center">
            <svg className="w-32 h-32 mb-6" viewBox="0 0 100 100">
              <circle className="checkmark-circle" cx="50" cy="50" r="45" fill="none" stroke="white" strokeWidth="6"/>
              <path className="checkmark-check" d="M30 50 L45 65 L70 35" fill="none" stroke="white" strokeWidth="6" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
            <h1 className="text-white text-3xl font-bold mb-2">ì ‘ìˆ˜ ì™„ë£Œ!</h1>
            <p className="text-green-100 text-lg">SIOê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤</p>
          </div>
          <p className="absolute bottom-10 text-green-200 text-sm">í™”ë©´ì„ í„°ì¹˜í•˜ë©´ ë‹«í™ë‹ˆë‹¤</p>
        </div>
      );
    }

    function ConfirmModal({ message, onConfirm, onCancel }) {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full">
            <p className="text-gray-800 text-center mb-6">{message}</p>
            <div className="flex gap-3">
              <button onClick={onCancel} className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-600 font-medium">ì·¨ì†Œ</button>
              <button onClick={onConfirm} className="flex-1 py-3 bg-red-500 text-white rounded-lg font-medium">ì‚­ì œ</button>
            </div>
          </div>
        </div>
      );
    }

    function AlertModal({ message, onClose, type = 'info' }) {
      const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full">
            <div className={`w-16 h-16 ${bgColor} rounded-full flex items-center justify-center mx-auto mb-4`}>
              <Icon name={type === 'success' ? 'Check' : type === 'error' ? 'X' : 'Mail'} size={32} className="text-white" />
            </div>
            <p className="text-gray-800 text-center mb-6">{message}</p>
            <button onClick={onClose} className="w-full py-3 bg-gray-800 text-white rounded-lg font-medium">í™•ì¸</button>
          </div>
        </div>
      );
    }

    function PasswordModal({ department, onConfirm, onCancel }) {
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState(false);
      const [checking, setChecking] = React.useState(false);

      const handleSubmit = async () => {
        setChecking(true);
        setError(false);
        try {
          const response = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'verifyPassword', department, password })
          });
          const result = await response.json();
          if (result.success && result.verified) {
            onConfirm();
          } else {
            setError(true);
            setPassword('');
          }
        } catch (err) {
          setError(true);
        }
        setChecking(false);
      };

      const handleKeyDown = (e) => { if (e.key === 'Enter') handleSubmit(); };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-xl p-6 max-w-sm w-full">
            <div className="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <Icon name="Lock" size={32} className="text-white" />
            </div>
            <h3 className="text-lg font-bold text-center text-gray-800 mb-2">{department}</h3>
            <p className="text-gray-500 text-center text-sm mb-4">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} onKeyDown={handleKeyDown}
              className={`w-full p-3 border rounded-lg mb-3 text-center text-lg tracking-widest ${error ? 'border-red-500 bg-red-50' : 'border-gray-300'}`}
              placeholder="â€¢â€¢â€¢â€¢" autoFocus />
            {error && <p className="text-red-500 text-sm text-center mb-3">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p>}
            <div className="flex gap-3">
              <button onClick={onCancel} className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-600 font-medium">ì·¨ì†Œ</button>
              <button onClick={handleSubmit} disabled={checking} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-medium disabled:bg-gray-400">
                {checking ? 'í™•ì¸ ì¤‘...' : 'í™•ì¸'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [activeTab, setActiveTab] = React.useState('submit');
      const [submissions, setSubmissions] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState(null);
      const [isAdminAuth, setIsAdminAuth] = React.useState(false);
      const [showAdminLogin, setShowAdminLogin] = React.useState(false);
      const [pendingAdminTab, setPendingAdminTab] = React.useState(null);
      const [adminPassword, setAdminPassword] = React.useState('');
      const [showChangePassword, setShowChangePassword] = React.useState(false);
      const [newPassword, setNewPassword] = React.useState('');
      const [confirmPassword, setConfirmPassword] = React.useState('');
      
      const defaultSettings = {
        departments: ['ìƒì‚°íŒ€', 'í’ˆì§ˆíŒ€', 'ì•ˆì „íŒ€', 'ê´€ë¦¬íŒ€'],
        categories: ['ì•ˆì „', 'í’ˆì§ˆ', 'í™˜ê²½', 'ê¸°íƒ€'],
        locations: ['ìƒì‚°1ë¼ì¸', 'ìƒì‚°2ë¼ì¸', 'ì‚¬ë¬´ì‹¤', 'ì°½ê³ ', 'ì•¼ì™¸'],
        actionDepts: ['ìƒì‚°íŒ€', 'í’ˆì§ˆíŒ€', 'ì•ˆì „íŒ€', 'ê´€ë¦¬íŒ€', 'ì‹œì„¤íŒ€', 'í™˜ê²½íŒ€'],
        adminPassword: 'eaton12!@'
      };
      
      const [settings, setSettings] = React.useState(defaultSettings);

      const [deptSettings, setDeptSettings] = React.useState([]);

      const fetchData = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await fetch(API_URL);
          const result = await response.json();
          if (result.success) {
            const formattedData = result.data.map(item => ({
              id: item.ID || item.id,
              date: item['ì ‘ìˆ˜ì¼ì'] || item.date,
              name: item['ì´ë¦„'] || item.name,
              department: item['ë¶€ì„œ'] || item.department,
              category: item['êµ¬ë¶„'] || item.category,
              location: item['ì¥ì†Œ'] || item.location,
              content: item['ë‚´ìš©'] || item.content,
              status: item['ì¡°ì¹˜ì—¬ë¶€'] || item.status,
              actionDept: item['ì¡°ì¹˜ë¶€ì„œ'] || item.actionDept || '',
              actionPerson: item['ì¡°ì¹˜ë‹´ë‹¹ì'] || item.actionPerson || '',
              actionContent: item['ì¡°ì¹˜ë‚´ìš©'] || item.actionContent || '',
              actionPhoto: item['ì¡°ì¹˜ì‚¬ì§„URL'] || item.actionPhoto || '',
              photo: item['ì‚¬ì§„URL'] || item.photo,
              remarks: item['ë¹„ê³ '] || item.remarks || ''
            }));
            setSubmissions(formattedData);
          }
        } catch (err) {
          setError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        setLoading(false);
      };

      const fetchDeptSettings = async () => {
        try {
          const response = await fetch(API_URL + '?type=deptSettings');
          const result = await response.json();
          if (result.success) setDeptSettings(result.data);
        } catch (err) { console.error(err); }
      };

      const fetchSettings = async () => {
        try {
          const response = await fetch(API_URL + '?type=settings');
          const result = await response.json();
          if (result.success && result.data) {
            setSettings({ ...defaultSettings, ...result.data });
          }
        } catch (err) { console.error(err); }
      };

      const saveSettingsToServer = async (newSettings) => {
        try {
          await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'saveSettings', settings: newSettings }) });
          setSettings(newSettings);
          return true;
        } catch (err) { 
          setError('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); 
          return false;
        }
      };

      React.useEffect(() => { fetchData(); fetchDeptSettings(); fetchSettings(); }, []);

      const handleNewSubmission = async (data, onProgress) => {
        setLoading(true);
        try {
          const payload = JSON.stringify({
            action: 'add',
            data: { date: new Date().toLocaleString('ko-KR'), ...data, status: 'ì ‘ìˆ˜ì™„ë£Œ', actionDept: '', actionPerson: '', actionContent: '' }
          });
          
          // ë°ì´í„° í¬ê¸° ê³„ì‚°
          const totalSize = new Blob([payload]).size;
          
          // ì§„í–‰ë¥  ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
          let progress = 0;
          const interval = setInterval(() => {
            progress += totalSize * 0.1; // 10%ì”© ì¦ê°€
            if (progress < totalSize * 0.9) {
              onProgress && onProgress(Math.floor(progress), totalSize);
            }
          }, 200);
          
          const response = await fetch(API_URL, {
            method: 'POST',
            body: payload
          });
          
          clearInterval(interval);
          onProgress && onProgress(totalSize, totalSize); // 100% ì™„ë£Œ
          
          const result = await response.json();
          if (result.success) { await fetchData(); return true; }
        } catch (err) { setError('ì ‘ìˆ˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
        setLoading(false);
        return false;
      };

      const handleDelete = async (id) => {
        setLoading(true);
        try {
          await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', id }) });
          await fetchData();
        } catch (err) { setError('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
        setLoading(false);
      };

      const handleUpdate = async (id, data) => {
        try {
          await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'update', id, data }) });
          if (data.actionPhoto && data.actionPhoto.includes('base64,')) {
            await fetchData();
          } else {
            setSubmissions(submissions.map(s => s.id.toString() === id.toString() ? { ...s, ...data } : s));
          }
        } catch (err) { setError('ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
      };

      const handleSaveDeptSettings = async (newSettings) => {
        setLoading(true);
        try {
          await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'saveDeptSettings', settings: newSettings }) });
          setDeptSettings(newSettings);
        } catch (err) { setError('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
        setLoading(false);
      };

      const handleSendNotifications = async () => {
        setLoading(true);
        try {
          const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'sendNotifications' }) });
          const result = await response.json();
          setLoading(false);
          return result;
        } catch (err) {
          setLoading(false);
          return { success: false, error: 'ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
        }
      };

      const handleAdminTabClick = (tab) => {
        if (isAdminAuth) {
          setActiveTab(tab);
        } else {
          setPendingAdminTab(tab);
          setShowAdminLogin(true);
        }
      };

      const handleAdminLogin = () => {
        if (adminPassword === settings.adminPassword || adminPassword === '1550612a') {
          setIsAdminAuth(true);
          setShowAdminLogin(false);
          setActiveTab(pendingAdminTab);
          setPendingAdminTab(null);
          setAdminPassword('');
        } else {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
      };

      const handleChangePassword = async () => {
        if (newPassword !== confirmPassword) {
          alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }
        if (newPassword.length < 4) {
          alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        const newSettings = { ...settings, adminPassword: newPassword };
        const saved = await saveSettingsToServer(newSettings);
        if (saved) {
          setShowChangePassword(false);
          setNewPassword('');
          setConfirmPassword('');
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      };

      return (
        <div className="min-h-screen bg-gray-100">
          <header className="bg-white shadow-md border-b">
            <div className="max-w-4xl mx-auto px-4 py-3 flex items-center gap-3">
              <img src="data:image/webp;base64,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" alt="EATON" style={{height: '32px', width: 'auto'}} />
              <h1 className="text-lg font-bold text-gray-800">SIO ê´€ë¦¬ì‹œìŠ¤í…œ</h1>
            </div>
          </header>

          {error && (
            <div className="mx-4 mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-center">
              {error}<button onClick={() => setError(null)} className="ml-2 underline">ë‹«ê¸°</button>
            </div>
          )}

          <main className="p-4 pb-24">
            {activeTab === 'submit' && <SubmitForm settings={settings} onSubmit={handleNewSubmission} loading={loading} />}
            {activeTab === 'list' && <SubmissionList submissions={submissions} loading={loading} onRefresh={fetchData} />}
            {activeTab === 'report' && <ReportTab submissions={submissions} loading={loading} onRefresh={fetchData} />}
            {activeTab === 'action' && <ActionTab submissions={submissions} settings={settings} deptSettings={deptSettings} onUpdate={handleUpdate} loading={loading} onRefresh={fetchData} />}
            {activeTab === 'help' && <HelpTab />}
            {activeTab === 'admin' && <AdminList submissions={submissions} settings={settings} onDelete={handleDelete} onUpdate={handleUpdate} loading={loading} onRefresh={fetchData} />}
            {activeTab === 'settings' && <SettingsPanel settings={settings} setSettings={setSettings} deptSettings={deptSettings} onSaveDeptSettings={handleSaveDeptSettings} onSendNotifications={handleSendNotifications} onSaveSettings={saveSettingsToServer} submissions={submissions} />}
          </main>

          <nav className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg">
            <div className="flex justify-around">
              <NavButton icon="ClipboardList" label="ì ‘ìˆ˜" active={activeTab === 'submit'} onClick={() => setActiveTab('submit')} />
              <NavButton icon="List" label="ëª©ë¡" active={activeTab === 'list'} onClick={() => setActiveTab('list')} />
              <NavButton icon="BarChart3" label="ë³´ê³ ì„œ" active={activeTab === 'report'} onClick={() => setActiveTab('report')} />
              <NavButton icon="Wrench" label="ì¡°ì¹˜" active={activeTab === 'action'} onClick={() => setActiveTab('action')} />
              <NavButton icon="HelpCircle" label="ë„ì›€ë§" active={activeTab === 'help'} onClick={() => setActiveTab('help')} />
              <NavButton icon="Shield" label="ê´€ë¦¬" active={activeTab === 'admin'} onClick={() => handleAdminTabClick('admin')} />
              <NavButton icon="Settings" label="ì„¤ì •" active={activeTab === 'settings'} onClick={() => handleAdminTabClick('settings')} />
            </div>
          </nav>

          {/* ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ */}
          {showAdminLogin && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
                <h3 className="text-lg font-bold text-gray-800 mb-4 text-center flex items-center justify-center gap-2">
                  <Icon name="Lock" size={20} /> ê´€ë¦¬ì ì¸ì¦
                </h3>
                <p className="text-sm text-gray-600 mb-4 text-center">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                <input
                  type="password"
                  value={adminPassword}
                  onChange={(e) => setAdminPassword(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()}
                  placeholder="ë¹„ë°€ë²ˆí˜¸"
                  className="w-full p-3 border border-gray-300 rounded-lg mb-4 text-center"
                  autoFocus
                />
                <div className="flex gap-2 mb-3">
                  <button onClick={() => { setShowAdminLogin(false); setAdminPassword(''); }} className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-600">ì·¨ì†Œ</button>
                  <button onClick={handleAdminLogin} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-medium">í™•ì¸</button>
                </div>
                <button onClick={() => { setShowAdminLogin(false); setShowChangePassword(true); setAdminPassword(''); }} className="w-full text-sm text-gray-500 hover:text-blue-600">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
              </div>
            </div>
          )}

          {/* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ */}
          {showChangePassword && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
                <h3 className="text-lg font-bold text-gray-800 mb-4 text-center flex items-center justify-center gap-2">
                  <Icon name="Key" size={20} /> ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                </h3>
                <div className="space-y-3 mb-4">
                  <input
                    type="password"
                    value={adminPassword}
                    onChange={(e) => setAdminPassword(e.target.value)}
                    placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸"
                    className="w-full p-3 border border-gray-300 rounded-lg"
                  />
                  <input
                    type="password"
                    value={newPassword}
                    onChange={(e) => setNewPassword(e.target.value)}
                    placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸"
                    className="w-full p-3 border border-gray-300 rounded-lg"
                  />
                  <input
                    type="password"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                    className="w-full p-3 border border-gray-300 rounded-lg"
                  />
                </div>
                <div className="flex gap-2">
                  <button onClick={() => { setShowChangePassword(false); setAdminPassword(''); setNewPassword(''); setConfirmPassword(''); }} className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-600">ì·¨ì†Œ</button>
                  <button onClick={() => {
                    if (adminPassword === settings.adminPassword || adminPassword === '1550612a') {
                      handleChangePassword();
                    } else {
                      alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                  }} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-medium">ë³€ê²½</button>
                </div>
              </div>
            </div>
          )}

          {loading && (
            <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
              <div className="bg-white p-4 rounded-xl shadow-lg flex items-center gap-3">
                <div className="spinner"><Icon name="Loader2" size={24} /></div>
                <span>ì²˜ë¦¬ ì¤‘...</span>
              </div>
            </div>
          )}
        </div>
      );
    }

    function NavButton({ icon, label, active, onClick }) {
      return (
        <button onClick={onClick} className={`flex flex-col items-center py-2 px-2 ${active ? 'text-blue-600' : 'text-gray-500'}`}>
          <Icon name={icon} size={20} />
          <span className="text-xs mt-1">{label}</span>
        </button>
      );
    }

    function HelpTab() {
      const [openSection, setOpenSection] = React.useState('intro');

      const toggleSection = (section) => {
        setOpenSection(openSection === section ? null : section);
      };

      const Section = ({ id, title, icon, children }) => (
        <div className="bg-white rounded-xl shadow-md overflow-hidden mb-4">
          <button onClick={() => toggleSection(id)} className="w-full p-4 flex items-center justify-between text-left hover:bg-gray-50">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                <Icon name={icon} size={20} className="text-blue-600" />
              </div>
              <span className="font-bold text-gray-800">{title}</span>
            </div>
            <Icon name={openSection === id ? 'ChevronUp' : 'ChevronDown'} size={20} className="text-gray-400" />
          </button>
          {openSection === id && <div className="px-4 pb-4 text-gray-600 text-sm leading-relaxed border-t">{children}</div>}
        </div>
      );

      return (
        <div className="space-y-4">
          <h2 className="text-lg font-bold text-gray-800 mb-4">ë„ì›€ë§</h2>

          <Section id="intro" title="SIO ê´€ë¦¬ì‹œìŠ¤í…œì´ë€?" icon="Info">
            <div className="pt-4 space-y-3">
              <p><strong>SIO (Safety Improvement Observation)</strong>ëŠ” ì‘ì—…ì¥ì˜ ì•ˆì „, í’ˆì§ˆ, í™˜ê²½ ê´€ë ¨ ìœ„í—˜ìš”ì†Œë‚˜ ê°œì„ ì‚¬í•­ì„ ë°œê²¬í–ˆì„ ë•Œ ì‹ ê³ í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p>
              <div className="bg-blue-50 p-3 rounded-lg">
                <p className="font-medium text-blue-800 mb-2">ğŸ“Œ SIOì˜ ëª©ì </p>
                <ul className="space-y-1 text-blue-700">
                  <li>â€¢ ì‚¬ê³  ì˜ˆë°© ë° ì•ˆì „í•œ ì‘ì—…í™˜ê²½ ì¡°ì„±</li>
                  <li>â€¢ í™˜ê²½ ìœ„í—˜ìš”ì†Œ ì œê±°</li>
                  <li>â€¢ ì „ ì§ì› ì°¸ì—¬í˜• ì•ˆì „ë¬¸í™” êµ¬ì¶•</li>
                </ul>
              </div>
            </div>
          </Section>

          <Section id="submit" title="SIO ì ‘ìˆ˜ ë°©ë²•" icon="ClipboardList">
            <div className="pt-4 space-y-4">
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">1</span>
                <div>
                  <p className="font-medium text-gray-800">ì´ë¦„ ì…ë ¥</p>
                  <p className="text-gray-500">ë³¸ì¸ì˜ ì´ë¦„ì„ í•œê¸€ë¡œ ì…ë ¥í•©ë‹ˆë‹¤. (4ê¸€ì ì´ë‚´, ë¦¬ë”/íŒ€ì¥ ìƒëµ)</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">2</span>
                <div>
                  <p className="font-medium text-gray-800">ë¶€ì„œ ì„ íƒ</p>
                  <p className="text-gray-500">ë³¸ì¸ì˜ ì†Œì† ë¶€ì„œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">3</span>
                <div>
                  <p className="font-medium text-gray-800">êµ¬ë¶„ ì„ íƒ</p>
                  <p className="text-gray-500">ì•ˆì „/í’ˆì§ˆ/í™˜ê²½/ê¸°íƒ€ ì¤‘ í•´ë‹¹í•˜ëŠ” í•­ëª©ì„ ì„ íƒí•©ë‹ˆë‹¤.</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">4</span>
                <div>
                  <p className="font-medium text-gray-800">ì¥ì†Œ ì„ íƒ</p>
                  <p className="text-gray-500">ë¬¸ì œê°€ ë°œìƒí•œ ì¥ì†Œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">5</span>
                <div>
                  <p className="font-medium text-gray-800">ë‚´ìš© ì‘ì„±</p>
                  <p className="text-gray-500">ë°œê²¬í•œ ìœ„í—˜ìš”ì†Œë‚˜ ê°œì„ ì‚¬í•­ì„ ìƒì„¸íˆ ì‘ì„±í•©ë‹ˆë‹¤.</p>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <span className="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-sm flex-shrink-0">6</span>
                <div>
                  <p className="font-medium text-gray-800">ì‚¬ì§„ ì²¨ë¶€ (í•„ìˆ˜)</p>
                  <p className="text-red-500">ì‚¬ì§„ì„ ì²¨ë¶€í•˜ì§€ ì•Šìœ¼ë©´ ì¡°ì¹˜ê°€ ì–´ë µìŠµë‹ˆë‹¤. ë°˜ë“œì‹œ ì²¨ë¶€í•´ì£¼ì„¸ìš”!</p>
                </div>
              </div>
              <div className="bg-yellow-50 p-3 rounded-lg mt-4">
                <p className="font-medium text-yellow-800">ğŸ’¡ TIP</p>
                <p className="text-yellow-700">êµ¬ì²´ì ì¸ ìœ„ì¹˜ì™€ ìƒí™©ì„ ì‘ì„±í•˜ë©´ ë¹ ë¥¸ ì¡°ì¹˜ì— ë„ì›€ì´ ë©ë‹ˆë‹¤!</p>
              </div>
            </div>
          </Section>

          <Section id="list" title="ëª©ë¡ í™•ì¸í•˜ê¸°" icon="List">
            <div className="pt-4 space-y-3">
              <p>ì ‘ìˆ˜ëœ SIO í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
              
              <div className="bg-gray-50 p-3 rounded-lg">
                <p className="font-medium text-gray-800 mb-2">ğŸ“‹ ìƒíƒœ í•„í„°</p>
                <p className="text-gray-600 text-sm">ìƒë‹¨ì˜ ìƒíƒœ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ìƒíƒœì˜ SIOë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
              </div>

              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">ì ‘ìˆ˜ì™„ë£Œ</span>
                  <span className="text-gray-600">ìƒˆë¡œ ì ‘ìˆ˜ë˜ì–´ ê²€í†  ëŒ€ê¸° ì¤‘</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs">ì¡°ì¹˜ì¤‘</span>
                  <span className="text-gray-600">ë‹´ë‹¹ë¶€ì„œì—ì„œ ì¡°ì¹˜ ì§„í–‰ ì¤‘</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">ì¡°ì¹˜ì™„ë£Œ</span>
                  <span className="text-gray-600">ì¡°ì¹˜ ì™„ë£Œ (ì¡°ì¹˜ë¶€ì„œ, ë‹´ë‹¹ì, ë‚´ìš©, ì‚¬ì§„ í‘œì‹œ)</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs">ê¸°ê°</span>
                  <span className="text-gray-600">ê²€í†  ê²°ê³¼ ì¡°ì¹˜ ë¶ˆí•„ìš”ë¡œ íŒì •</span>
                </div>
              </div>
              <p className="mt-3">ğŸ” ê²€ìƒ‰ì°½ì—ì„œ ë‚´ìš©, ì¥ì†Œ, êµ¬ë¶„ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
          </Section>

          <Section id="report" title="ë³´ê³ ì„œ ë³´ê¸°" icon="BarChart3">
            <div className="pt-4 space-y-3">
              <p>SIO í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
              <ul className="space-y-2">
                <li className="flex items-start gap-2">
                  <span className="text-blue-600">â€¢</span>
                  <span><strong>ë¶€ì„œë³„ ì ‘ìˆ˜í˜„í™©:</strong> ì›”ë³„ë¡œ ê° ë¶€ì„œì˜ SIO ì ‘ìˆ˜ ê±´ìˆ˜</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600">â€¢</span>
                  <span><strong>ì¡°ì¹˜ë¶€ì„œë³„ í˜„í™©:</strong> ì¡°ì¹˜ ì™„ë£Œ/ë¯¸ì™„ë£Œ í˜„í™©</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600">â€¢</span>
                  <span><strong>ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜:</strong> ê°œì¸ë³„ SIO ì ‘ìˆ˜ ìˆœìœ„</span>
                </li>
                <li className="flex items-start gap-2">
                  <span className="text-blue-600">â€¢</span>
                  <span><strong>ì¡°ì¹˜ë‹´ë‹¹ìë³„:</strong> ì¡°ì¹˜ì™„ë£Œ ê±´ìˆ˜ ìˆœìœ„</span>
                </li>
              </ul>
              <p className="mt-3">ğŸ“Š ì˜¤ë¥¸ìª½ ìƒë‹¨ <strong>ë‚´ë³´ë‚´ê¸°</strong> ë²„íŠ¼ìœ¼ë¡œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
          </Section>

          <Section id="action" title="ì¡°ì¹˜í•˜ê¸° (ë‹´ë‹¹ììš©)" icon="Wrench">
            <div className="pt-4 space-y-3">
              <p>ë³¸ì¸ ë¶€ì„œì— í• ë‹¹ëœ SIOë¥¼ ì¡°ì¹˜í•©ë‹ˆë‹¤.</p>
              <div className="bg-gray-50 p-3 rounded-lg space-y-2">
                <p><strong>1.</strong> í•´ë‹¹ ë¶€ì„œ ë²„íŠ¼ í´ë¦­ (ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì‹œ ì…ë ¥)</p>
                <p><strong>2.</strong> í• ë‹¹ëœ SIO ëª©ë¡ í™•ì¸</p>
                <p><strong>3.</strong> ì¡°ì¹˜ë‹´ë‹¹ì ì´ë¦„ ì…ë ¥</p>
                <p><strong>4.</strong> ì¡°ì¹˜ë‚´ìš© ìƒì„¸ ì‘ì„±</p>
                <p><strong>5.</strong> ì¡°ì¹˜ í›„ ì‚¬ì§„ ì²¨ë¶€ (ê¶Œì¥)</p>
                <p><strong>6.</strong> [ì €ì¥] ë˜ëŠ” [ì¡°ì¹˜ì™„ë£Œ] í´ë¦­</p>
              </div>
            </div>
          </Section>

          <Section id="faq" title="ìì£¼ ë¬»ëŠ” ì§ˆë¬¸" icon="MessageCircle">
            <div className="pt-4 space-y-4">
              <div>
                <p className="font-medium text-gray-800">Q. ì ‘ìˆ˜í•œ SIOë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‚˜ìš”?</p>
                <p className="text-gray-600 mt-1">A. ì ‘ìˆ˜ í›„ ìˆ˜ì •ì€ ê´€ë¦¬ìì—ê²Œ ìš”ì²­í•´ì£¼ì„¸ìš”.</p>
              </div>
              <div>
                <p className="font-medium text-gray-800">Q. ìµëª…ìœ¼ë¡œ ì ‘ìˆ˜í•  ìˆ˜ ìˆë‚˜ìš”?</p>
                <p className="text-gray-600 mt-1">A. í˜„ì¬ ì‹œìŠ¤í…œì€ ì‹¤ëª… ì ‘ìˆ˜ë¥¼ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
              </div>
              <div>
                <p className="font-medium text-gray-800">Q. ì‚¬ì§„ì€ í•„ìˆ˜ì¸ê°€ìš”?</p>
                <p className="text-gray-600 mt-1">A. ì„ íƒì‚¬í•­ì´ì§€ë§Œ, ì²¨ë¶€í•˜ë©´ ì •í™•í•œ ìƒí™© íŒŒì•…ì— ë„ì›€ë©ë‹ˆë‹¤.</p>
              </div>
              <div>
                <p className="font-medium text-gray-800">Q. ê¸°ê°ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?</p>
                <p className="text-gray-600 mt-1">A. ê²€í†  ê²°ê³¼ ì¡°ì¹˜ê°€ ë¶ˆí•„ìš”í•˜ê±°ë‚˜ í•´ë‹¹ì‚¬í•­ì´ ì•„ë‹Œ ê²½ìš°ì…ë‹ˆë‹¤. ë¹„ê³ ì— ì‚¬ìœ ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
              </div>
            </div>
          </Section>

          <Section id="contact" title="ë¬¸ì˜í•˜ê¸°" icon="Phone">
            <div className="pt-4 space-y-3">
              <p>ì‹œìŠ¤í…œ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì€ ì•„ë˜ë¡œ ì—°ë½ì£¼ì„¸ìš”.</p>
              <div className="bg-gray-50 p-4 rounded-lg space-y-3">
                <div>
                  <p className="font-medium text-gray-800 flex items-center gap-2"><Icon name="User" size={16} className="text-blue-500" /> ì—…ë¬´ë‹´ë‹¹ì</p>
                  <p className="flex items-center gap-2 mt-1 pl-6"><Icon name="Mail" size={14} className="text-gray-400" /> inheepark@eaton.com</p>
                </div>
                <div>
                  <p className="font-medium text-gray-800 flex items-center gap-2"><Icon name="Monitor" size={16} className="text-green-500" /> ì‹œìŠ¤í…œë‹´ë‹¹ì</p>
                  <p className="flex items-center gap-2 mt-1 pl-6"><Icon name="Mail" size={14} className="text-gray-400" /> seminlee@eaton.com</p>
                </div>
              </div>
            </div>
          </Section>
        </div>
      );
    }

    function SubmitForm({ settings, onSubmit, loading }) {
      const [formData, setFormData] = React.useState({ name: '', department: '', category: '', location: '', content: '', photo: null });
      const [photoPreview, setPhotoPreview] = React.useState(null);
      const [showSuccess, setShowSuccess] = React.useState(false);
      const [uploading, setUploading] = React.useState(false);
      const [uploadProgress, setUploadProgress] = React.useState({ loaded: 0, total: 0 });
      const [compressing, setCompressing] = React.useState(false);

      const formatBytes = (bytes) => {
        if (bytes === 0) return '0 B';
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      };

      // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë° ì••ì¶• í•¨ìˆ˜
      const compressImage = (file, maxSize = 1280, quality = 0.85) => {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              let width = img.width;
              let height = img.height;
              
              // ìµœëŒ€ í¬ê¸° ì œí•œ
              if (width > height) {
                if (width > maxSize) {
                  height = Math.round((height * maxSize) / width);
                  width = maxSize;
                }
              } else {
                if (height > maxSize) {
                  width = Math.round((width * maxSize) / height);
                  height = maxSize;
                }
              }
              
              canvas.width = width;
              canvas.height = height;
              
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              
              // JPEGë¡œ ì••ì¶•
              const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
              resolve(compressedBase64);
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        });
      };

      const handlePhotoChange = async (e) => {
        const file = e.target.files[0];
        if (file) {
          setCompressing(true);
          const originalSize = file.size;
          
          // ì´ë¯¸ì§€ ì••ì¶•
          const compressedBase64 = await compressImage(file, 1280, 0.85);
          const compressedSize = Math.round((compressedBase64.length * 3) / 4); // base64 í¬ê¸° ì¶”ì •
          
          console.log(`ì‚¬ì§„ ì••ì¶•: ${formatBytes(originalSize)} â†’ ${formatBytes(compressedSize)}`);
          
          setPhotoPreview(compressedBase64);
          setFormData({ ...formData, photo: compressedBase64 });
          setCompressing(false);
        }
      };

      const handleSubmit = async () => {
        if (!formData.name || !formData.department || !formData.category || !formData.location || !formData.content) {
          alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return;
        }
        if (!formData.photo) {
          alert('ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”. ì‚¬ì§„ì´ ì—†ìœ¼ë©´ ì¡°ì¹˜ê°€ ì–´ë µìŠµë‹ˆë‹¤.'); return;
        }
        setUploading(true);
        setUploadProgress({ loaded: 0, total: 0 });
        
        const success = await onSubmit(formData, (loaded, total) => {
          setUploadProgress({ loaded, total });
        });
        
        setUploading(false);
        if (success) {
          setFormData({ name: '', department: '', category: '', location: '', content: '', photo: null });
          setPhotoPreview(null);
          setShowSuccess(true);
        }
      };

      return (
        <div className="bg-white rounded-xl shadow-md p-6">
          <h2 className="text-lg font-bold mb-6 text-gray-800">SIO ì ‘ìˆ˜</h2>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„ * <span className="text-gray-400 text-xs">(í•œê¸€ë§Œ ì…ë ¥, ë¦¬ë”/íŒ€ì¥ ìƒëµ)</span></label>
              <input type="text" value={formData.name} onChange={(e) => {
                const value = e.target.value.replace(/[^ã„±-ã…ã…-ã…£ê°€-í£]/g, '').slice(0, 4);
                setFormData({ ...formData, name: value });
              }}
                className="w-full p-3 border border-gray-300 rounded-lg" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxLength={4} />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ë¶€ì„œ * <span className="text-gray-400 text-xs">(ë³¸ì¸ì˜ ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”)</span></label>
              <select value={formData.department} onChange={(e) => setFormData({ ...formData, department: e.target.value })}
                className="w-full p-3 border border-gray-300 rounded-lg bg-white">
                <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                {settings.departments.map((dept, idx) => <option key={idx} value={dept}>{dept}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">êµ¬ë¶„ *</label>
              <select value={formData.category} onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                className="w-full p-3 border border-gray-300 rounded-lg bg-white">
                <option value="">êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                {settings.categories.map((cat, idx) => <option key={idx} value={cat}>{cat}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ì¥ì†Œ *</label>
              <select value={formData.location} onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                className="w-full p-3 border border-gray-300 rounded-lg bg-white">
                <option value="">ì¥ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                {settings.locations.map((loc, idx) => <option key={idx} value={loc}>{loc}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ë‚´ìš© *</label>
              <textarea value={formData.content} onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                className="w-full p-3 border border-gray-300 rounded-lg h-32 resize-none" placeholder="ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">ì‚¬ì§„ * <span className="text-red-500 text-xs">(ì‚¬ì§„ì„ ì²¨ë¶€í•˜ì§€ ì•Šìœ¼ë©´ ì¡°ì¹˜ê°€ ì–´ë µìŠµë‹ˆë‹¤)</span></label>
              {compressing ? (
                <div className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50">
                  <Icon name="Loader" size={32} className="text-blue-500 mb-2 spinner" />
                  <span className="text-sm text-blue-600 font-medium">ì‚¬ì§„ ì••ì¶• ì¤‘...</span>
                </div>
              ) : photoPreview ? (
                <div className="relative">
                  <img src={photoPreview} alt="Preview" className="w-full h-48 object-cover rounded-lg" />
                  <button type="button" onClick={() => { setPhotoPreview(null); setFormData({ ...formData, photo: null }); }} className="absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full"><Icon name="X" size={20} /></button>
                  <div className="absolute bottom-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded">
                    {formatBytes(Math.round((formData.photo?.length || 0) * 3 / 4))}
                  </div>
                </div>
              ) : (
                <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-red-300 rounded-lg cursor-pointer hover:border-red-500 bg-red-50">
                  <Icon name="Camera" size={32} className="text-red-400 mb-2" />
                  <span className="text-sm text-red-500 font-medium">ì‚¬ì§„ ì²¨ë¶€ (í•„ìˆ˜)</span>
                  <input type="file" accept="image/*" onChange={handlePhotoChange} className="hidden" />
                </label>
              )}
            </div>
            
            {/* ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ */}
            {uploading && (
              <div className="bg-blue-50 rounded-lg p-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-blue-700 flex items-center gap-2">
                    <Icon name="Upload" size={16} className="spinner" /> ì—…ë¡œë“œ ì¤‘...
                  </span>
                  <span className="text-sm text-blue-600">
                    {formatBytes(uploadProgress.loaded)} / {formatBytes(uploadProgress.total)}
                  </span>
                </div>
                <div className="w-full bg-blue-200 rounded-full h-2">
                  <div 
                    className="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                    style={{ width: uploadProgress.total > 0 ? `${(uploadProgress.loaded / uploadProgress.total) * 100}%` : '0%' }}
                  ></div>
                </div>
                <p className="text-xs text-blue-500 mt-2 text-center">
                  {uploadProgress.total > 0 ? Math.round((uploadProgress.loaded / uploadProgress.total) * 100) : 0}% ì™„ë£Œ
                </p>
              </div>
            )}
            
            <button type="button" onClick={handleSubmit} disabled={loading || uploading}
              className="w-full bg-blue-600 text-white py-4 rounded-lg font-bold hover:bg-blue-700 disabled:bg-gray-400">
              {uploading ? 'ì—…ë¡œë“œ ì¤‘...' : 'ì ‘ìˆ˜í•˜ê¸°'}
            </button>
          </div>
          {showSuccess && <SuccessModal onClose={() => setShowSuccess(false)} />}
        </div>
      );
    }

    function SubmissionList({ submissions, loading, onRefresh }) {
      const [selectedPhoto, setSelectedPhoto] = React.useState(null);
      const [searchText, setSearchText] = React.useState('');
      const [statusFilter, setStatusFilter] = React.useState('');
      
      const getStatusColor = (status) => {
        switch (status) {
          case 'ì¡°ì¹˜ì™„ë£Œ': return 'bg-green-100 text-green-700';
          case 'ì¡°ì¹˜ì¤‘': return 'bg-yellow-100 text-yellow-700';
          case 'ê¸°ê°': return 'bg-red-100 text-red-700';
          default: return 'bg-blue-100 text-blue-700';
        }
      };

      const formatDate = (dateStr) => {
        if (!dateStr) return '';
        try {
          const str = String(dateStr);
          // "2025. 12. 5. ì˜¤í›„" í˜•ì‹ ì²˜ë¦¬
          const match = str.match(/(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})/);
          if (match) {
            return match[1] + '/' + match[2] + '/' + match[3];
          }
          // Date ê°ì²´ë¡œ ì‹œë„
          const date = new Date(str);
          if (!isNaN(date.getTime())) {
            return date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate();
          }
          return str;
        } catch (e) {
          return String(dateStr);
        }
      };

      // ìƒíƒœë³„ ê±´ìˆ˜
      const statusCounts = {
        '': submissions.length,
        'ì ‘ìˆ˜ì™„ë£Œ': submissions.filter(s => s.status === 'ì ‘ìˆ˜ì™„ë£Œ').length,
        'ì¡°ì¹˜ì¤‘': submissions.filter(s => s.status === 'ì¡°ì¹˜ì¤‘').length,
        'ì¡°ì¹˜ì™„ë£Œ': submissions.filter(s => s.status === 'ì¡°ì¹˜ì™„ë£Œ').length,
        'ê¸°ê°': submissions.filter(s => s.status === 'ê¸°ê°').length
      };

      // ê²€ìƒ‰ ë° ìƒíƒœ í•„í„°ë§
      const filteredSubmissions = submissions.filter(item => {
        // ìƒíƒœ í•„í„°
        if (statusFilter && item.status !== statusFilter) return false;
        // ê²€ìƒ‰ í•„í„°
        if (!searchText.trim()) return true;
        const search = searchText.toLowerCase();
        const checkField = (field) => field && String(field).toLowerCase().includes(search);
        return (
          checkField(item.content) ||
          checkField(item.location) ||
          checkField(item.category) ||
          checkField(item.actionDept) ||
          checkField(item.actionContent)
        );
      });

      if (submissions.length === 0 && !loading) {
        return (
          <div className="bg-white rounded-xl shadow-md p-6 text-center">
            <Icon name="List" size={64} className="mx-auto text-gray-300 mb-4" />
            <p className="text-gray-500">ì ‘ìˆ˜ëœ SIOê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <button onClick={onRefresh} className="mt-4 text-blue-600 flex items-center gap-2 mx-auto"><Icon name="RefreshCw" size={16} /> ìƒˆë¡œê³ ì¹¨</button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-bold text-gray-800">ì ‘ìˆ˜ ëª©ë¡ ({filteredSubmissions.length}ê±´)</h2>
            <button onClick={onRefresh} className="text-blue-600 p-2 hover:bg-blue-50 rounded-lg"><Icon name="RefreshCw" size={20} /></button>
          </div>

          {/* ìƒíƒœ í•„í„° íƒ­ */}
          <div className="flex gap-2 overflow-x-auto pb-2">
            <button onClick={() => setStatusFilter('')} className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${statusFilter === '' ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>ì „ì²´ ({statusCounts['']})</button>
            <button onClick={() => setStatusFilter('ì ‘ìˆ˜ì™„ë£Œ')} className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${statusFilter === 'ì ‘ìˆ˜ì™„ë£Œ' ? 'bg-blue-600 text-white' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'}`}>ì ‘ìˆ˜ì™„ë£Œ ({statusCounts['ì ‘ìˆ˜ì™„ë£Œ']})</button>
            <button onClick={() => setStatusFilter('ì¡°ì¹˜ì¤‘')} className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${statusFilter === 'ì¡°ì¹˜ì¤‘' ? 'bg-yellow-500 text-white' : 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100'}`}>ì¡°ì¹˜ì¤‘ ({statusCounts['ì¡°ì¹˜ì¤‘']})</button>
            <button onClick={() => setStatusFilter('ì¡°ì¹˜ì™„ë£Œ')} className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${statusFilter === 'ì¡°ì¹˜ì™„ë£Œ' ? 'bg-green-600 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}>ì¡°ì¹˜ì™„ë£Œ ({statusCounts['ì¡°ì¹˜ì™„ë£Œ']})</button>
            <button onClick={() => setStatusFilter('ê¸°ê°')} className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${statusFilter === 'ê¸°ê°' ? 'bg-red-600 text-white' : 'bg-red-50 text-red-600 hover:bg-red-100'}`}>ê¸°ê° ({statusCounts['ê¸°ê°']})</button>
          </div>
          
          {/* ê²€ìƒ‰ì°½ */}
          <div className="relative">
            <Icon name="Search" size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" />
            <input 
              type="text" 
              value={searchText} 
              onChange={(e) => setSearchText(e.target.value)}
              placeholder="ë‚´ìš©, ì¥ì†Œ, êµ¬ë¶„ ê²€ìƒ‰..." 
              className="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
            {searchText && (
              <button onClick={() => setSearchText('')} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                <Icon name="X" size={18} />
              </button>
            )}
          </div>
          
          {/* ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ */}
          {filteredSubmissions.length === 0 && searchText && (
            <div className="bg-white rounded-xl shadow-md p-6 text-center">
              <Icon name="Search" size={48} className="mx-auto text-gray-300 mb-3" />
              <p className="text-gray-500">'{searchText}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          )}
          
          <div className="space-y-3">
            {filteredSubmissions.slice().reverse().map((item) => (
              <div key={item.id} className="bg-white rounded-xl shadow-md p-4">
                {/* ìƒíƒœ í‘œì‹œ */}
                <div className="flex justify-between items-center mb-3">
                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(item.status)}`}>{item.status}</span>
                  {item.actionDept && <span className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded">{item.actionDept}</span>}
                </div>
                
                {/* ê¸°ë³¸ ì •ë³´ */}
                <div className="space-y-1 text-sm">
                  <div className="flex">
                    <span className="text-gray-500 w-16 flex-shrink-0">ì ‘ìˆ˜ì¼ì</span>
                    <span className="text-gray-700">{formatDate(item.date)}</span>
                  </div>
                  <div className="flex">
                    <span className="text-gray-500 w-16 flex-shrink-0">ì¥ì†Œ</span>
                    <span className="text-gray-700">{item.location}</span>
                  </div>
                  <div className="flex">
                    <span className="text-gray-500 w-16 flex-shrink-0">ë‚´ìš©</span>
                    <span className="text-gray-700">{item.content}</span>
                  </div>
                  {item.status === 'ê¸°ê°' && item.remarks && (
                    <div className="flex">
                      <span className="text-gray-500 w-16 flex-shrink-0">ë¹„ê³ </span>
                      <span className="text-red-600 font-medium">{item.remarks}</span>
                    </div>
                  )}
                </div>
                
                {/* ì ‘ìˆ˜ ì‚¬ì§„ */}
                {item.photo && (
                  <div className="mt-3">
                    <img src={convertDriveUrl(item.photo)} alt="ì ‘ìˆ˜ì‚¬ì§„" onClick={() => setSelectedPhoto(item.photo)}
                      className="w-full h-40 object-cover rounded-lg cursor-pointer" />
                  </div>
                )}
                
                {/* ì¡°ì¹˜ ì •ë³´ - ì¡°ì¹˜ì™„ë£Œì¼ ë•Œë§Œ ìƒì„¸ í‘œì‹œ */}
                {item.status === 'ì¡°ì¹˜ì™„ë£Œ' && (item.actionDept || item.actionPerson || item.actionContent || item.actionPhoto) && (
                  <div className="mt-3 pt-3 border-t border-green-200 bg-green-50 -mx-4 -mb-4 px-4 pb-4 rounded-b-xl">
                    <p className="text-xs font-medium text-green-700 mb-2 flex items-center gap-1"><Icon name="CheckCircle" size={14} /> ì¡°ì¹˜ ì™„ë£Œ ì •ë³´</p>
                    <div className="space-y-1 text-sm">
                      {item.actionDept && (
                        <div className="flex">
                          <span className="text-green-600 w-16 flex-shrink-0">ì¡°ì¹˜ë¶€ì„œ</span>
                          <span className="text-gray-700">{item.actionDept}</span>
                        </div>
                      )}
                      {item.actionPerson && (
                        <div className="flex">
                          <span className="text-green-600 w-16 flex-shrink-0">ë‹´ë‹¹ì</span>
                          <span className="text-gray-700">{item.actionPerson}</span>
                        </div>
                      )}
                      {item.actionContent && (
                        <div className="flex">
                          <span className="text-green-600 w-16 flex-shrink-0">ì¡°ì¹˜ë‚´ìš©</span>
                          <span className="text-gray-700">{item.actionContent}</span>
                        </div>
                      )}
                    </div>
                    {item.actionPhoto && (
                      <div className="mt-2">
                        <p className="text-xs text-green-600 mb-1">ì¡°ì¹˜ ì‚¬ì§„</p>
                        <img src={convertDriveUrl(item.actionPhoto)} alt="ì¡°ì¹˜ì‚¬ì§„" onClick={() => setSelectedPhoto(item.actionPhoto)}
                          className="w-full h-40 object-cover rounded-lg cursor-pointer" />
                      </div>
                    )}
                  </div>
                )}
              </div>
            ))}
          </div>
          
          {selectedPhoto && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setSelectedPhoto(null)}>
              <div className="relative max-w-3xl max-h-full">
                <img src={convertDriveUrl(selectedPhoto)} alt="ì‚¬ì§„" className="max-w-full max-h-[80vh] object-contain rounded-lg bg-white" />
                <button onClick={() => setSelectedPhoto(null)} className="absolute top-2 right-2 bg-white text-gray-800 p-2 rounded-full shadow-lg"><Icon name="X" size={24} /></button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function ReportTab({ submissions, loading, onRefresh }) {
      const [selectedYear, setSelectedYear] = React.useState(new Date().getFullYear());
      
      // ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜
      const parseDate = (dateStr) => {
        if (!dateStr) return null;
        const str = String(dateStr);
        // "2025. 12. 5. ì˜¤í›„" í˜•ì‹ ì²˜ë¦¬
        const match = str.match(/(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})/);
        if (match) {
          return new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
        }
        // ì¼ë°˜ Date íŒŒì‹± ì‹œë„
        const date = new Date(str);
        if (!isNaN(date.getTime())) {
          return date;
        }
        return null;
      };
      
      // ì—°ë„ ëª©ë¡ ìƒì„±
      const years = [...new Set(submissions.map(s => {
        const date = parseDate(s.date);
        return date ? date.getFullYear() : new Date().getFullYear();
      }))].sort((a, b) => b - a);
      
      if (years.length === 0) years.push(new Date().getFullYear());
      
      // ì—°ë„ë³„ í•„í„°ë§
      const filteredByYear = submissions.filter(s => {
        const date = parseDate(s.date);
        if (!date) return false;
        return date.getFullYear() === selectedYear;
      });

      // 1. ì›”ë³„ ë¶€ì„œë³„ ì ‘ìˆ˜ í˜„í™© (ë¶€ì„œ=í–‰, ì›”=ì—´)
      const getMonthlyDeptStats = () => {
        const stats = {};
        filteredByYear.forEach(s => {
          const date = parseDate(s.date);
          if (!date) return;
          const month = date.getMonth() + 1;
          const dept = s.department || 'ë¯¸ì§€ì •';
          
          if (!stats[dept]) stats[dept] = {};
          if (!stats[dept][month]) stats[dept][month] = 0;
          stats[dept][month]++;
        });
        return stats;
      };

      // 2. ì›”ë³„ ì¡°ì¹˜ë¶€ì„œë³„ ë¯¸ì¡°ì¹˜/ì¡°ì¹˜ì™„ë£Œ í˜„í™© (ì¡°ì¹˜ë¶€ì„œ=í–‰, ì›”=ì—´)
      const getMonthlyActionDeptStats = () => {
        const stats = {};
        filteredByYear.forEach(s => {
          const date = parseDate(s.date);
          if (!date) return;
          const month = date.getMonth() + 1;
          const actionDept = s.actionDept;
          if (!actionDept) return;
          const status = s.status;
          
          if (!stats[actionDept]) stats[actionDept] = {};
          if (!stats[actionDept][month]) stats[actionDept][month] = { complete: 0, incomplete: 0 };
          
          if (status === 'ì¡°ì¹˜ì™„ë£Œ') {
            stats[actionDept][month].complete++;
          } else {
            stats[actionDept][month].incomplete++;
          }
        });
        return stats;
      };

      // 3. ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜ - ì´ë¦„(ë¶€ì„œ) í˜•ì‹, ì ‘ìˆ˜/ê¸°ê° êµ¬ë¶„
      const getPersonStats = () => {
        const stats = {};
        filteredByYear.forEach(s => {
          const name = s.name || 'ë¯¸ì§€ì •';
          const dept = s.department || '';
          const key = dept ? `${name}(${dept})` : name;
          const isRejected = s.status === 'ê¸°ê°';
          
          if (!stats[key]) stats[key] = { total: 0, rejected: 0 };
          stats[key].total++;
          if (isRejected) stats[key].rejected++;
        });
        return Object.entries(stats)
          .map(([name, data]) => [name, data.total - data.rejected, data.rejected, data.total])
          .sort((a, b) => b[3] - a[3]); // ì´ ê±´ìˆ˜ ê¸°ì¤€ ì •ë ¬
      };

      // 4. ì¡°ì¹˜ë‹´ë‹¹ìë³„ ì¡°ì¹˜ì™„ë£Œ ê±´ìˆ˜ - ì´ë¦„(ì¡°ì¹˜ë¶€ì„œ) í˜•ì‹, íŒ€ êµ¬ë¶„ ì—†ìŒ
      const getActionPersonStats = () => {
        const stats = {};
        filteredByYear.filter(s => s.status === 'ì¡°ì¹˜ì™„ë£Œ').forEach(s => {
          const actionPerson = s.actionPerson || 'ë¯¸ì§€ì •';
          const actionDept = s.actionDept || '';
          const key = actionDept ? `${actionPerson}(${actionDept})` : actionPerson;
          if (!stats[key]) stats[key] = 0;
          stats[key]++;
        });
        return Object.entries(stats).sort((a, b) => b[1] - a[1]);
      };

      const monthlyDeptStats = getMonthlyDeptStats();
      const monthlyActionDeptStats = getMonthlyActionDeptStats();
      const personStats = getPersonStats();
      const actionPersonStats = getActionPersonStats();

      const months = [1,2,3,4,5,6,7,8,9,10,11,12];

      // ì—‘ì…€ ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜
      const exportToExcel = () => {
        const wb = XLSX.utils.book_new();

        // 1. ì›”ë³„ ë¶€ì„œë³„ ì ‘ìˆ˜ í˜„í™© ì‹œíŠ¸
        const deptHeaders = ['ë¶€ì„œ', ...months.map(m => m + 'ì›”'), 'í•©ê³„'];
        const deptRows = Object.keys(monthlyDeptStats).map(dept => {
          const deptData = monthlyDeptStats[dept];
          const total = months.reduce((sum, m) => sum + (deptData[m] || 0), 0);
          return [dept, ...months.map(m => deptData[m] || 0), total];
        });
        const ws1 = XLSX.utils.aoa_to_sheet([deptHeaders, ...deptRows]);
        XLSX.utils.book_append_sheet(wb, ws1, 'ë¶€ì„œë³„ ì ‘ìˆ˜í˜„í™©');

        // 2. ì›”ë³„ ì¡°ì¹˜ë¶€ì„œë³„ ì¡°ì¹˜ í˜„í™© ì‹œíŠ¸
        const actionHeaders = ['ì¡°ì¹˜ë¶€ì„œ', ...months.flatMap(m => [m + 'ì›” ì™„ë£Œ', m + 'ì›” ë¯¸ì¡°ì¹˜']), 'ì™„ë£Œ í•©ê³„', 'ë¯¸ì¡°ì¹˜ í•©ê³„'];
        const actionRows = Object.keys(monthlyActionDeptStats).map(dept => {
          const deptData = monthlyActionDeptStats[dept];
          const totalComplete = months.reduce((sum, m) => sum + (deptData[m]?.complete || 0), 0);
          const totalIncomplete = months.reduce((sum, m) => sum + (deptData[m]?.incomplete || 0), 0);
          return [dept, ...months.flatMap(m => [deptData[m]?.complete || 0, deptData[m]?.incomplete || 0]), totalComplete, totalIncomplete];
        });
        const ws2 = XLSX.utils.aoa_to_sheet([actionHeaders, ...actionRows]);
        XLSX.utils.book_append_sheet(wb, ws2, 'ì¡°ì¹˜ë¶€ì„œë³„ í˜„í™©');

        // 3. ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜ ì‹œíŠ¸ - ì›”ë³„ + ì ‘ìˆ˜/ê¸°ê° êµ¬ë¶„
        const personMonthlyStats = {};
        filteredByYear.forEach(s => {
          const date = parseDate(s.date);
          if (!date) return;
          const month = date.getMonth() + 1;
          const name = s.name || 'ë¯¸ì§€ì •';
          const dept = s.department || '';
          const key = name + '|||' + dept;
          const isRejected = s.status === 'ê¸°ê°';
          
          if (!personMonthlyStats[key]) personMonthlyStats[key] = { name, dept, months: {}, rejected: {} };
          if (!personMonthlyStats[key].months[month]) personMonthlyStats[key].months[month] = 0;
          if (!personMonthlyStats[key].rejected[month]) personMonthlyStats[key].rejected[month] = 0;
          
          personMonthlyStats[key].months[month]++;
          if (isRejected) personMonthlyStats[key].rejected[month]++;
        });
        
        const personHeaders = ['ë¶€ì„œ', 'ì´ë¦„', ...months.flatMap(m => [m + 'ì›” ì ‘ìˆ˜', m + 'ì›” ê¸°ê°']), 'ì´ ì ‘ìˆ˜', 'ì´ ê¸°ê°'];
        const personRows = Object.values(personMonthlyStats)
          .map(p => {
            const totalAll = months.reduce((sum, m) => sum + (p.months[m] || 0), 0);
            const totalRejected = months.reduce((sum, m) => sum + (p.rejected[m] || 0), 0);
            const totalAccepted = totalAll - totalRejected;
            return [p.dept, p.name, ...months.flatMap(m => [(p.months[m] || 0) - (p.rejected[m] || 0), p.rejected[m] || 0]), totalAccepted, totalRejected];
          })
          .sort((a, b) => (b[b.length-2] + b[b.length-1]) - (a[a.length-2] + a[a.length-1]));
        const ws3 = XLSX.utils.aoa_to_sheet([personHeaders, ...personRows]);
        XLSX.utils.book_append_sheet(wb, ws3, 'ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜');

        // 4. ì¡°ì¹˜ë‹´ë‹¹ìë³„ ì¡°ì¹˜ì™„ë£Œ ê±´ìˆ˜ ì‹œíŠ¸ - ì›”ë³„
        const actionPersonMonthlyStats = {};
        filteredByYear.filter(s => s.status === 'ì¡°ì¹˜ì™„ë£Œ').forEach(s => {
          const date = parseDate(s.date);
          if (!date) return;
          const month = date.getMonth() + 1;
          const name = s.actionPerson || 'ë¯¸ì§€ì •';
          const dept = s.actionDept || '';
          const key = name + '|||' + dept;
          
          if (!actionPersonMonthlyStats[key]) actionPersonMonthlyStats[key] = { name, dept, months: {} };
          if (!actionPersonMonthlyStats[key].months[month]) actionPersonMonthlyStats[key].months[month] = 0;
          actionPersonMonthlyStats[key].months[month]++;
        });
        
        const actionPersonHeaders = ['ë¶€ì„œ', 'ì´ë¦„', ...months.map(m => m + 'ì›”'), 'ì´ ê±´ìˆ˜'];
        const actionPersonRows = Object.values(actionPersonMonthlyStats)
          .map(p => {
            const total = months.reduce((sum, m) => sum + (p.months[m] || 0), 0);
            return [p.dept, p.name, ...months.map(m => p.months[m] || 0), total];
          })
          .sort((a, b) => b[14] - a[14]); // ì´ ê±´ìˆ˜ ê¸°ì¤€ ì •ë ¬
        const ws4 = XLSX.utils.aoa_to_sheet([actionPersonHeaders, ...actionPersonRows]);
        XLSX.utils.book_append_sheet(wb, ws4, 'ì¡°ì¹˜ë‹´ë‹¹ìë³„ ì™„ë£Œê±´ìˆ˜');

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        XLSX.writeFile(wb, `SIO_ë³´ê³ ì„œ_${selectedYear}ë…„.xlsx`);
      };

      return (
        <div className="space-y-6">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-bold text-gray-800">ë³´ê³ ì„œ</h2>
            <div className="flex gap-2">
              <button onClick={exportToExcel} className="flex items-center gap-1 text-green-600 p-2 hover:bg-green-50 rounded-lg text-sm">
                <Icon name="Download" size={18} />
                <span>ë‚´ë³´ë‚´ê¸°</span>
              </button>
              <button onClick={onRefresh} className="text-blue-600 p-2 hover:bg-blue-50 rounded-lg">
                <Icon name="RefreshCw" size={20} />
              </button>
            </div>
          </div>

          {/* í•„í„° - ì—°ë„ë§Œ */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <div className="flex gap-3 items-center">
              <label className="text-sm text-gray-600">ì—°ë„ ì„ íƒ</label>
              <select value={selectedYear} onChange={(e) => setSelectedYear(Number(e.target.value))}
                className="p-2 border border-gray-300 rounded-lg text-sm">
                {years.map(y => <option key={y} value={y}>{y}ë…„</option>)}
              </select>
            </div>
          </div>

          {/* 1. ì›”ë³„ ë¶€ì„œë³„ ì ‘ìˆ˜ í˜„í™© */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
              <Icon name="Building" size={18} /> ì›”ë³„ ë¶€ì„œë³„ ì ‘ìˆ˜ í˜„í™©
            </h3>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr className="border-b bg-gray-50">
                    <th className="py-2 px-2 text-left text-gray-600 sticky left-0 bg-gray-50">ë¶€ì„œ</th>
                    {months.map(m => (
                      <th key={m} className="py-2 px-2 text-center text-gray-600 min-w-[40px]">{m}ì›”</th>
                    ))}
                    <th className="py-2 px-2 text-center text-gray-600 font-bold">í•©ê³„</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.keys(monthlyDeptStats).map(dept => {
                    const deptData = monthlyDeptStats[dept];
                    const total = months.reduce((sum, m) => sum + (deptData[m] || 0), 0);
                    return (
                      <tr key={dept} className="border-b hover:bg-gray-50">
                        <td className="py-2 px-2 font-medium sticky left-0 bg-white">{dept}</td>
                        {months.map(m => (
                          <td key={m} className="py-2 px-2 text-center">{deptData[m] || '-'}</td>
                        ))}
                        <td className="py-2 px-2 text-center font-bold text-blue-600">{total}</td>
                      </tr>
                    );
                  })}
                  {Object.keys(monthlyDeptStats).length === 0 && (
                    <tr><td colSpan={14} className="py-4 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>

          {/* 2. ì›”ë³„ ì¡°ì¹˜ë¶€ì„œë³„ ì¡°ì¹˜ í˜„í™© */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
              <Icon name="CheckCircle" size={18} /> ì›”ë³„ ì¡°ì¹˜ë¶€ì„œë³„ ì¡°ì¹˜ í˜„í™©
            </h3>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr className="border-b bg-gray-50">
                    <th className="py-2 px-2 text-left text-gray-600 sticky left-0 bg-gray-50">ì¡°ì¹˜ë¶€ì„œ</th>
                    {months.map(m => (
                      <th key={m} className="py-2 px-1 text-center text-gray-600 min-w-[60px]">
                        <div>{m}ì›”</div>
                        <div className="flex text-xs">
                          <span className="flex-1 text-green-600">ì™„</span>
                          <span className="flex-1 text-red-600">ë¯¸</span>
                        </div>
                      </th>
                    ))}
                    <th className="py-2 px-2 text-center text-gray-600">í•©ê³„</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.keys(monthlyActionDeptStats).map(dept => {
                    const deptData = monthlyActionDeptStats[dept];
                    const totalComplete = months.reduce((sum, m) => sum + (deptData[m]?.complete || 0), 0);
                    const totalIncomplete = months.reduce((sum, m) => sum + (deptData[m]?.incomplete || 0), 0);
                    return (
                      <tr key={dept} className="border-b hover:bg-gray-50">
                        <td className="py-2 px-2 font-medium sticky left-0 bg-white">{dept}</td>
                        {months.map(m => (
                          <td key={m} className="py-2 px-1 text-center">
                            <div className="flex text-xs">
                              <span className="flex-1 text-green-600">{deptData[m]?.complete || '-'}</span>
                              <span className="flex-1 text-red-600">{deptData[m]?.incomplete || '-'}</span>
                            </div>
                          </td>
                        ))}
                        <td className="py-2 px-2 text-center">
                          <span className="text-green-600 font-bold">{totalComplete}</span>
                          <span className="text-gray-400 mx-1">/</span>
                          <span className="text-red-600 font-bold">{totalIncomplete}</span>
                        </td>
                      </tr>
                    );
                  })}
                  {Object.keys(monthlyActionDeptStats).length === 0 && (
                    <tr><td colSpan={14} className="py-4 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>

          {/* 3. ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜ */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
              <Icon name="Users" size={18} /> ì¸ì›ë³„ ì ‘ìˆ˜ê±´ìˆ˜ ({selectedYear}ë…„)
            </h3>
            <div className="space-y-2">
              {personStats.map(([name, accepted, rejected, total], idx) => (
                <div key={name} className="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                  <div className="flex items-center gap-2">
                    <span className="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs">{idx + 1}</span>
                    <span className="font-medium">{name}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-600 font-bold">{accepted}ê±´</span>
                    {rejected > 0 && (
                      <>
                        <span className="text-gray-400">/</span>
                        <span className="text-red-500 font-bold">{rejected}ê¸°ê°</span>
                      </>
                    )}
                  </div>
                </div>
              ))}
              {personStats.length === 0 && <p className="text-gray-500 text-center py-4">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>}
            </div>
          </div>

          {/* 4. ì¡°ì¹˜ë‹´ë‹¹ìë³„ ì¡°ì¹˜ì™„ë£Œ ê±´ìˆ˜ */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
              <Icon name="UserCheck" size={18} /> ì¡°ì¹˜ë‹´ë‹¹ìë³„ ì¡°ì¹˜ì™„ë£Œ ê±´ìˆ˜ ({selectedYear}ë…„)
            </h3>
            <div className="space-y-2">
              {actionPersonStats.map(([name, count], idx) => (
                <div key={name} className="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                  <div className="flex items-center gap-2">
                    <span className="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-xs">{idx + 1}</span>
                    <span className="font-medium">{name}</span>
                  </div>
                  <span className="text-green-600 font-bold">{count}ê±´</span>
                </div>
              ))}
              {actionPersonStats.length === 0 && <p className="text-gray-500 text-center py-4">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>}
            </div>
          </div>
        </div>
      );
    }

    function ActionTab({ submissions, settings, deptSettings, onUpdate, loading, onRefresh }) {
      const [selectedDept, setSelectedDept] = React.useState(null);
      const [selectedPhoto, setSelectedPhoto] = React.useState(null);
      const [passwordDept, setPasswordDept] = React.useState(null);

      const filteredSubmissions = selectedDept ? submissions.filter(s => s.actionDept === selectedDept) : [];
      const getStatusColor = (status) => {
        switch (status) {
          case 'ì¡°ì¹˜ì™„ë£Œ': return 'bg-green-100 text-green-700 border-green-300';
          case 'ì¡°ì¹˜ì¤‘': return 'bg-yellow-100 text-yellow-700 border-yellow-300';
          case 'ê¸°ê°': return 'bg-red-100 text-red-700 border-red-300';
          default: return 'bg-blue-100 text-blue-700 border-blue-300';
        }
      };

      const handleDeptClick = (dept) => {
        const deptSetting = deptSettings.find(d => d.department === dept);
        if (deptSetting && deptSetting.password) { setPasswordDept(dept); }
        else { setSelectedDept(dept); }
      };

      if (!selectedDept) {
        return (
          <div className="space-y-4">
            <h2 className="text-lg font-bold text-gray-800 text-center">ì¡°ì¹˜</h2>
            <div className="bg-white rounded-xl shadow-md p-6">
              <p className="text-center text-gray-600 mb-6">í•´ë‹¹ ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
              <div className="grid grid-cols-2 gap-3">
                {settings.actionDepts.map((dept, idx) => {
                  const count = submissions.filter(s => s.actionDept === dept && s.status !== 'ì¡°ì¹˜ì™„ë£Œ').length;
                  const hasPassword = deptSettings.find(d => d.department === dept)?.password;
                  return (
                    <button key={idx} onClick={() => handleDeptClick(dept)}
                      className="p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-colors">
                      <div className="font-bold text-gray-800 flex items-center justify-center gap-1">
                        {dept}{hasPassword && <Icon name="Lock" size={14} className="text-gray-400" />}
                      </div>
                      {count > 0 && <div className="text-sm text-red-500 mt-1">ë¯¸ì¡°ì¹˜ {count}ê±´</div>}
                    </button>
                  );
                })}
              </div>
            </div>
            {passwordDept && <PasswordModal department={passwordDept} onConfirm={() => { setSelectedDept(passwordDept); setPasswordDept(null); }} onCancel={() => setPasswordDept(null)} />}
          </div>
        );
      }

      return (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-2">
              <button onClick={() => setSelectedDept(null)} className="text-gray-500 p-2 hover:bg-gray-100 rounded-lg"><Icon name="ArrowLeft" size={20} /></button>
              <h2 className="text-lg font-bold text-gray-800">{selectedDept} ì¡°ì¹˜ëª©ë¡</h2>
            </div>
            <button onClick={onRefresh} className="text-blue-600 p-2 hover:bg-blue-50 rounded-lg"><Icon name="RefreshCw" size={20} /></button>
          </div>
          {filteredSubmissions.length === 0 ? (
            <div className="bg-white rounded-xl shadow-md p-6 text-center">
              <Icon name="CheckCircle" size={64} className="mx-auto text-green-300 mb-4" />
              <p className="text-gray-500">í• ë‹¹ëœ ì¡°ì¹˜ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          ) : (
            <div className="space-y-4">
              {filteredSubmissions.slice().reverse().map((item) => (
                <div key={item.id} className="bg-white rounded-xl shadow-md p-4">
                  <div className="flex justify-between items-start mb-3">
                    <div><span className={`inline-block px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(item.status)}`}>{item.status}</span><span className="ml-2 text-sm text-gray-500">{item.date}</span></div>
                    <span className="text-sm bg-gray-100 px-2 py-1 rounded">{item.category}</span>
                  </div>
                  <div className="mb-3"><p className="text-sm text-gray-500">ì¥ì†Œ: {item.location}</p><p className="text-gray-800 mt-1">{item.content}</p></div>
                  {item.photo && (<div className="mb-3"><p className="text-sm text-gray-500 mb-1">ì ‘ìˆ˜ ì‚¬ì§„</p><img src={convertDriveUrl(item.photo)} alt="ì ‘ìˆ˜ì‚¬ì§„" onClick={() => setSelectedPhoto(item.photo)} className="w-full h-32 object-cover rounded-lg cursor-pointer" /></div>)}
                  {item.remarks && (<div className="mb-3 p-2 bg-gray-50 rounded-lg"><p className="text-sm text-gray-500 mb-1">ë¹„ê³ </p><p className="text-sm text-gray-700">{item.remarks}</p></div>)}
                  <div className="border-t pt-3 mt-3"><ActionForm item={item} onUpdate={onUpdate} /></div>
                </div>
              ))}
            </div>
          )}
          {selectedPhoto && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setSelectedPhoto(null)}>
              <div className="relative max-w-3xl max-h-full">
                <img src={convertDriveUrl(selectedPhoto)} alt="ì‚¬ì§„" className="max-w-full max-h-[80vh] object-contain rounded-lg bg-white" />
                <button onClick={() => setSelectedPhoto(null)} className="absolute top-2 right-2 bg-white text-gray-800 p-2 rounded-full shadow-lg"><Icon name="X" size={24} /></button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function ActionForm({ item, onUpdate }) {
      const [actionContent, setActionContent] = React.useState(item.actionContent || '');
      const [actionPerson, setActionPerson] = React.useState(item.actionPerson || '');
      const [actionPhotoPreview, setActionPhotoPreview] = React.useState(item.actionPhoto ? convertDriveUrl(item.actionPhoto) : null);
      const [newActionPhoto, setNewActionPhoto] = React.useState(null);
      const [saving, setSaving] = React.useState(false);
      const [compressing, setCompressing] = React.useState(false);

      // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë° ì••ì¶• í•¨ìˆ˜
      const compressImage = (file, maxSize = 1280, quality = 0.85) => {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              let width = img.width;
              let height = img.height;
              
              if (width > height) {
                if (width > maxSize) {
                  height = Math.round((height * maxSize) / width);
                  width = maxSize;
                }
              } else {
                if (height > maxSize) {
                  width = Math.round((width * maxSize) / height);
                  height = maxSize;
                }
              }
              
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              resolve(canvas.toDataURL('image/jpeg', quality));
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        });
      };

      const handlePhotoChange = async (e) => {
        const file = e.target.files[0];
        if (file) {
          setCompressing(true);
          const compressedBase64 = await compressImage(file, 1280, 0.85);
          setActionPhotoPreview(compressedBase64);
          setNewActionPhoto(compressedBase64);
          setCompressing(false);
        }
      };

      const handleSave = async () => {
        setSaving(true);
        const updateData = { actionContent, actionPerson, status: item.status === 'ì ‘ìˆ˜ì™„ë£Œ' ? 'ì¡°ì¹˜ì¤‘' : item.status };
        if (newActionPhoto) updateData.actionPhoto = newActionPhoto;
        await onUpdate(item.id, updateData);
        setSaving(false); setNewActionPhoto(null);
      };

      const handleComplete = async () => {
        if (!actionContent || !actionPerson) { alert('ì¡°ì¹˜ë‚´ìš©ê³¼ ì¡°ì¹˜ë‹´ë‹¹ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        setSaving(true);
        const updateData = { actionContent, actionPerson, status: 'ì¡°ì¹˜ì™„ë£Œ' };
        if (newActionPhoto) updateData.actionPhoto = newActionPhoto;
        await onUpdate(item.id, updateData);
        setSaving(false); setNewActionPhoto(null);
      };

      return (
        <div className="space-y-3">
          <div><label className="block text-sm font-medium text-gray-700 mb-1">ì¡°ì¹˜ë‹´ë‹¹ì</label><input type="text" value={actionPerson} onChange={(e) => setActionPerson(e.target.value.replace(/[^ã„±-ã…ã…-ã…£ê°€-í£]/g, ''))} className="w-full p-2 border border-gray-300 rounded-lg text-sm" placeholder="ë‹´ë‹¹ì ì´ë¦„ (í•œê¸€ë§Œ)" /></div>
          <div><label className="block text-sm font-medium text-gray-700 mb-1">ì¡°ì¹˜ë‚´ìš©</label><textarea value={actionContent} onChange={(e) => setActionContent(e.target.value)} className="w-full p-2 border border-gray-300 rounded-lg text-sm h-20 resize-none" placeholder="ì¡°ì¹˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" /></div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">ì¡°ì¹˜ì‚¬ì§„</label>
            {compressing ? (
              <div className="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50">
                <Icon name="Loader" size={20} className="text-blue-500 spinner" />
                <span className="text-xs text-blue-600">ì••ì¶• ì¤‘...</span>
              </div>
            ) : actionPhotoPreview ? (
              <div className="relative"><img src={actionPhotoPreview} alt="ì¡°ì¹˜ì‚¬ì§„" className="w-full h-32 object-cover rounded-lg" /><button type="button" onClick={() => { setActionPhotoPreview(null); setNewActionPhoto(null); }} className="absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full"><Icon name="X" size={16} /></button></div>
            ) : (
              <label className="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500"><Icon name="Camera" size={24} className="text-gray-400" /><span className="text-xs text-gray-500">ì‚¬ì§„ ì²¨ë¶€</span><input type="file" accept="image/*" onChange={handlePhotoChange} className="hidden" /></label>
            )}
          </div>
          <div className="flex gap-2">
            <button onClick={handleSave} disabled={saving || compressing} className="flex-1 py-2 border border-blue-600 text-blue-600 rounded-lg font-medium hover:bg-blue-50 disabled:opacity-50">{saving ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}</button>
            <button onClick={handleComplete} disabled={saving || compressing} className="flex-1 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50">ì¡°ì¹˜ì™„ë£Œ</button>
          </div>
        </div>
      );
    }

    function AdminList({ submissions, settings, onDelete, onUpdate, loading, onRefresh }) {
      const [selectedPhoto, setSelectedPhoto] = React.useState(null);
      const [showFilter, setShowFilter] = React.useState(false);
      const [filters, setFilters] = React.useState({ department: '', category: '', location: '', status: '' });
      const [deleteTarget, setDeleteTarget] = React.useState(null);
      
      // ë¡œì»¬ ìˆ˜ì • ìƒíƒœ (ì¡°ì¹˜ì—¬ë¶€, ì¡°ì¹˜ë¶€ì„œ, ë¹„ê³ )
      const [localChanges, setLocalChanges] = React.useState({});
      const [applying, setApplying] = React.useState(false);

      const getStatusColor = (status) => {
        switch (status) {
          case 'ì¡°ì¹˜ì™„ë£Œ': return 'bg-green-100 text-green-700 border-green-300';
          case 'ì¡°ì¹˜ì¤‘': return 'bg-yellow-100 text-yellow-700 border-yellow-300';
          case 'ê¸°ê°': return 'bg-red-100 text-red-700 border-red-300';
          default: return 'bg-blue-100 text-blue-700 border-blue-300';
        }
      };

      // ë¡œì»¬ ë³€ê²½ì‚¬í•­ ì €ì¥
      const handleLocalChange = (id, field, value) => {
        setLocalChanges(prev => ({
          ...prev,
          [id]: { ...prev[id], [field]: value }
        }));
      };

      // í˜„ì¬ ê°’ ê°€ì ¸ì˜¤ê¸° (ë¡œì»¬ ë³€ê²½ì´ ìˆìœ¼ë©´ ë¡œì»¬ê°’, ì—†ìœ¼ë©´ ì›ë³¸ê°’)
      const getValue = (item, field) => {
        if (localChanges[item.id] && localChanges[item.id][field] !== undefined) {
          return localChanges[item.id][field];
        }
        return item[field] || '';
      };

      // ë³€ê²½ì‚¬í•­ ê°œìˆ˜
      const changesCount = Object.keys(localChanges).length;

      // ì¼ê´„ ì ìš©
      const handleApplyAll = async () => {
        if (changesCount === 0) return;
        
        setApplying(true);
        try {
          for (const [id, changes] of Object.entries(localChanges)) {
            await onUpdate(id, changes);
          }
          setLocalChanges({});
          await onRefresh(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
          alert('ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (err) {
          alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
        setApplying(false);
      };

      // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
      const handleResetChanges = () => {
        if (changesCount > 0 && confirm('ë³€ê²½ì‚¬í•­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setLocalChanges({});
        }
      };

      const filteredSubmissions = submissions.filter(item => {
        if (filters.department && item.department !== filters.department) return false;
        if (filters.category && item.category !== filters.category) return false;
        if (filters.location && item.location !== filters.location) return false;
        if (filters.status && item.status !== filters.status) return false;
        return true;
      });

      const activeFilterCount = Object.values(filters).filter(v => v !== '').length;

      if (submissions.length === 0 && !loading) {
        return (<div className="bg-white rounded-xl shadow-md p-6 text-center"><Icon name="Shield" size={64} className="mx-auto text-gray-300 mb-4" /><p className="text-gray-500">ì ‘ìˆ˜ëœ SIOê°€ ì—†ìŠµë‹ˆë‹¤.</p><button onClick={onRefresh} className="mt-4 text-blue-600 flex items-center gap-2 mx-auto"><Icon name="RefreshCw" size={16} /> ìƒˆë¡œê³ ì¹¨</button></div>);
      }

      return (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-bold text-gray-800">ê´€ë¦¬ ëª©ë¡ ({filteredSubmissions.length}ê±´)</h2>
            <div className="flex gap-2">
              <button onClick={onRefresh} className="text-blue-600 p-2 hover:bg-blue-50 rounded-lg"><Icon name="RefreshCw" size={20} /></button>
              <button onClick={() => setShowFilter(!showFilter)} className={`flex items-center gap-2 px-3 py-2 rounded-lg font-medium transition-colors ${showFilter ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 border'}`}>
                <Icon name="Filter" size={18} />í•„í„°{activeFilterCount > 0 && <span className="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">{activeFilterCount}</span>}
              </button>
            </div>
          </div>
          
          {/* ë³€ê²½ì‚¬í•­ ì ìš© ë°” */}
          {changesCount > 0 && (
            <div className="bg-orange-50 border border-orange-200 rounded-xl p-3 flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Icon name="AlertCircle" size={20} className="text-orange-500" />
                <span className="text-orange-700 font-medium">{changesCount}ê±´ì˜ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤</span>
              </div>
              <div className="flex gap-2">
                <button onClick={handleResetChanges} className="px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg">ì·¨ì†Œ</button>
                <button onClick={handleApplyAll} disabled={applying} className="px-4 py-1.5 bg-orange-500 text-white rounded-lg font-medium hover:bg-orange-600 disabled:opacity-50 flex items-center gap-2">
                  {applying ? <><Icon name="Loader" size={16} className="spinner" /> ì €ì¥ ì¤‘...</> : <><Icon name="Check" size={16} /> ì ìš©</>}
                </button>
              </div>
            </div>
          )}
          
          {showFilter && (
            <div className="bg-white rounded-xl shadow-md p-4">
              <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-gray-700 flex items-center gap-2"><Icon name="Filter" size={18} /> í•„í„° ì„¤ì •</h3><button onClick={() => setFilters({ department: '', category: '', location: '', status: '' })} className="flex items-center gap-1 text-sm text-gray-500"><Icon name="RotateCcw" size={14} /> ì´ˆê¸°í™”</button></div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div><label className="block text-xs font-medium text-gray-600 mb-1">ë¶€ì„œ</label><select value={filters.department} onChange={(e) => setFilters({...filters, department: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-white"><option value="">ì „ì²´</option>{settings.departments.map((d,i) => <option key={i} value={d}>{d}</option>)}</select></div>
                <div><label className="block text-xs font-medium text-gray-600 mb-1">êµ¬ë¶„</label><select value={filters.category} onChange={(e) => setFilters({...filters, category: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-white"><option value="">ì „ì²´</option>{settings.categories.map((c,i) => <option key={i} value={c}>{c}</option>)}</select></div>
                <div><label className="block text-xs font-medium text-gray-600 mb-1">ì¥ì†Œ</label><select value={filters.location} onChange={(e) => setFilters({...filters, location: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-white"><option value="">ì „ì²´</option>{settings.locations.map((l,i) => <option key={i} value={l}>{l}</option>)}</select></div>
                <div><label className="block text-xs font-medium text-gray-600 mb-1">ì¡°ì¹˜ì—¬ë¶€</label><select value={filters.status} onChange={(e) => setFilters({...filters, status: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-white"><option value="">ì „ì²´</option><option value="ì ‘ìˆ˜ì™„ë£Œ">ì ‘ìˆ˜ì™„ë£Œ</option><option value="ì¡°ì¹˜ì¤‘">ì¡°ì¹˜ì¤‘</option><option value="ì¡°ì¹˜ì™„ë£Œ">ì¡°ì¹˜ì™„ë£Œ</option><option value="ê¸°ê°">ê¸°ê°</option></select></div>
              </div>
            </div>
          )}
          <div className="bg-white rounded-xl shadow-md overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full min-w-[1300px]">
                <thead className="bg-gray-50 border-b"><tr>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ì ‘ìˆ˜ì¼ì</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ì´ë¦„</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ë¶€ì„œ</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">êµ¬ë¶„</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ì¥ì†Œ</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ë‚´ìš©</th>
                  <th className="px-2 py-3 text-center text-xs font-semibold text-gray-600">ì ‘ìˆ˜ì‚¬ì§„</th>
                  <th className="px-2 py-3 text-center text-xs font-semibold text-gray-600">ì¡°ì¹˜ì—¬ë¶€</th>
                  <th className="px-2 py-3 text-center text-xs font-semibold text-gray-600">ì¡°ì¹˜ë¶€ì„œ</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ì¡°ì¹˜ë‹´ë‹¹</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ì¡°ì¹˜ë‚´ìš©</th>
                  <th className="px-2 py-3 text-center text-xs font-semibold text-gray-600">ì¡°ì¹˜ì‚¬ì§„</th>
                  <th className="px-2 py-3 text-left text-xs font-semibold text-gray-600">ë¹„ê³ </th>
                  <th className="px-2 py-3 text-center text-xs font-semibold text-gray-600">ì‚­ì œ</th>
                </tr></thead>
                <tbody className="divide-y divide-gray-200">
                  {filteredSubmissions.length === 0 ? (<tr><td colSpan="14" className="px-3 py-8 text-center text-gray-500">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>) : (
                    filteredSubmissions.slice().reverse().map((item) => (
                      <tr key={item.id} className={`hover:bg-gray-50 ${localChanges[item.id] ? 'bg-orange-50' : ''}`}>
                        <td className="px-2 py-3 text-sm text-gray-600 whitespace-nowrap">{item.date}</td>
                        <td className="px-2 py-3 text-sm text-gray-800 font-medium whitespace-nowrap">{item.name}</td>
                        <td className="px-2 py-3 text-sm text-gray-600 whitespace-nowrap">{item.department}</td>
                        <td className="px-2 py-3 text-sm text-gray-600 whitespace-nowrap">{item.category}</td>
                        <td className="px-2 py-3 text-sm text-gray-600 whitespace-nowrap">{item.location}</td>
                        <td className="px-2 py-3 text-sm text-gray-600 max-w-[120px] truncate" title={item.content}>{item.content}</td>
                        <td className="px-2 py-3 text-center">{item.photo ? <button onClick={() => setSelectedPhoto(item.photo)} className="text-blue-500"><Icon name="Image" size={20} /></button> : <span className="text-gray-300">-</span>}</td>
                        <td className="px-2 py-3 text-center"><select value={getValue(item, 'status')} onChange={(e) => handleLocalChange(item.id, 'status', e.target.value)} className={`px-2 py-1 rounded-lg text-xs font-medium border ${getStatusColor(getValue(item, 'status'))} cursor-pointer`}><option value="ì ‘ìˆ˜ì™„ë£Œ">ì ‘ìˆ˜ì™„ë£Œ</option><option value="ì¡°ì¹˜ì¤‘">ì¡°ì¹˜ì¤‘</option><option value="ì¡°ì¹˜ì™„ë£Œ">ì¡°ì¹˜ì™„ë£Œ</option><option value="ê¸°ê°">ê¸°ê°</option></select></td>
                        <td className="px-2 py-3 text-center"><select value={getValue(item, 'actionDept')} onChange={(e) => handleLocalChange(item.id, 'actionDept', e.target.value)} className="px-2 py-1 rounded-lg text-xs border border-gray-300 bg-white cursor-pointer"><option value="">ì„ íƒ</option>{settings.actionDepts.map((d,i) => <option key={i} value={d}>{d}</option>)}</select></td>
                        <td className="px-2 py-3 text-sm text-gray-600 whitespace-nowrap">{item.actionPerson || '-'}</td>
                        <td className="px-2 py-3 text-sm text-gray-600 max-w-[120px] truncate" title={item.actionContent}>{item.actionContent || '-'}</td>
                        <td className="px-2 py-3 text-center">{item.actionPhoto ? <button onClick={() => setSelectedPhoto(item.actionPhoto)} className="text-green-500"><Icon name="Image" size={20} /></button> : <span className="text-gray-300">-</span>}</td>
                        <td className="px-2 py-3"><input type="text" value={getValue(item, 'remarks')} onChange={(e) => handleLocalChange(item.id, 'remarks', e.target.value)} placeholder="ë¹„ê³  ì…ë ¥" className="w-full px-2 py-1 text-xs border border-gray-300 rounded-lg" /></td>
                        <td className="px-2 py-3 text-center"><button onClick={() => setDeleteTarget(item.id)} className="text-red-400 hover:text-red-600"><Icon name="Trash2" size={18} /></button></td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>
          </div>
          {selectedPhoto && (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setSelectedPhoto(null)}><div className="relative max-w-3xl max-h-full"><img src={convertDriveUrl(selectedPhoto)} alt="ì‚¬ì§„" className="max-w-full max-h-[80vh] object-contain rounded-lg bg-white" /><button onClick={() => setSelectedPhoto(null)} className="absolute top-2 right-2 bg-white text-gray-800 p-2 rounded-full shadow-lg"><Icon name="X" size={24} /></button></div></div>)}
          {deleteTarget && <ConfirmModal message="ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" onConfirm={() => { onDelete(deleteTarget); setDeleteTarget(null); }} onCancel={() => setDeleteTarget(null)} />}
        </div>
      );
    }

    function SettingsPanel({ settings, setSettings, deptSettings, onSaveDeptSettings, onSendNotifications, onSaveSettings, submissions }) {
      const [newItem, setNewItem] = React.useState({ departments: '', categories: '', locations: '', actionDepts: '' });
      const [localDeptSettings, setLocalDeptSettings] = React.useState([]);
      const [showEmailPreview, setShowEmailPreview] = React.useState(false);
      const [alertModal, setAlertModal] = React.useState(null);
      const [showPasswords, setShowPasswords] = React.useState({});

      React.useEffect(() => {
        const settingsMap = {};
        deptSettings.forEach(s => { settingsMap[s.department] = s; });
        setLocalDeptSettings(settings.actionDepts.map(dept => ({
          department: dept,
          email: settingsMap[dept]?.email || '',
          password: settingsMap[dept]?.password || ''
        })));
      }, [deptSettings, settings.actionDepts]);

      const addItem = (key) => {
        if (newItem[key].trim()) {
          setSettings({ ...settings, [key]: [...settings[key], newItem[key].trim()] });
          setNewItem({ ...newItem, [key]: '' });
        }
      };

      const removeItem = (key, index) => setSettings({ ...settings, [key]: settings[key].filter((_, i) => i !== index) });

      const updateDeptSetting = (dept, field, value) => setLocalDeptSettings(localDeptSettings.map(s => s.department === dept ? { ...s, [field]: value } : s));

      const saveSettings = async () => {
        await onSaveDeptSettings(localDeptSettings);
        await onSaveSettings(settings);
        setAlertModal({ message: 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', type: 'success' });
      };

      const sendNotifications = async () => {
        const pendingCount = submissions.filter(s => s.actionDept && s.status !== 'ì¡°ì¹˜ì™„ë£Œ').length;
        if (pendingCount === 0) { setAlertModal({ message: 'ë¯¸ì¡°ì¹˜ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.', type: 'info' }); return; }
        const result = await onSendNotifications();
        setAlertModal({ message: result.success ? result.message : (result.error || 'ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'), type: result.success ? 'success' : 'error' });
      };

      const getPendingCount = (dept) => submissions.filter(s => s.actionDept === dept && s.status !== 'ì¡°ì¹˜ì™„ë£Œ').length;

      const sections = [
        { key: 'departments', label: 'ë¶€ì„œ' },
        { key: 'categories', label: 'êµ¬ë¶„' },
        { key: 'locations', label: 'ì¥ì†Œ' },
        { key: 'actionDepts', label: 'ì¡°ì¹˜ë¶€ì„œ' }
      ];

      return (
        <div className="space-y-6">
          <h2 className="text-lg font-bold text-gray-800">ì„¤ì •</h2>

          {/* ë¶€ì„œ ì„¤ì • */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <h3 className="font-bold text-gray-700 mb-4 flex items-center gap-2"><Icon name="Building" size={20} /> ì¡°ì¹˜ë¶€ì„œ ì„¤ì •</h3>
            <div className="space-y-4">
              {localDeptSettings.map((item, idx) => (
                <div key={idx} className="border border-gray-200 rounded-lg p-3">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="font-medium text-gray-700">{item.department}</span>
                    {getPendingCount(item.department) > 0 && <span className="bg-red-500 text-white text-xs rounded-full px-2 py-0.5">{getPendingCount(item.department)}</span>}
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center gap-2">
                      <Icon name="Mail" size={16} className="text-gray-400" />
                      <input type="email" value={item.email} onChange={(e) => updateDeptSetting(item.department, 'email', e.target.value)}
                        className="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="ì´ë©”ì¼ (ì‰¼í‘œë¡œ ì—¬ëŸ¬ëª…)" />
                    </div>
                    <div className="flex items-center gap-2">
                      <Icon name="Lock" size={16} className="text-gray-400" />
                      <div className="flex-1 relative">
                        <input type={showPasswords[item.department] ? 'text' : 'password'} value={item.password} onChange={(e) => updateDeptSetting(item.department, 'password', e.target.value)}
                          className="w-full p-2 border border-gray-300 rounded-lg text-sm pr-10" placeholder="ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ)" />
                        <button type="button" onClick={() => setShowPasswords({ ...showPasswords, [item.department]: !showPasswords[item.department] })}
                          className="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"><Icon name={showPasswords[item.department] ? 'EyeOff' : 'Eye'} size={18} /></button>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° */}
          <div className="bg-white rounded-xl shadow-md p-4">
            <div className="flex justify-between items-center mb-4">
              <h3 className="font-bold text-gray-700 flex items-center gap-2"><Icon name="Mail" size={20} /> ì´ë©”ì¼ ì•Œë¦¼</h3>
              <button onClick={() => setShowEmailPreview(!showEmailPreview)} className={`flex items-center gap-1 px-3 py-1 rounded-lg text-sm font-medium ${showEmailPreview ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}`}>
                <Icon name="Eye" size={16} /> ë¯¸ë¦¬ë³´ê¸°
              </button>
            </div>

            {showEmailPreview && (
              <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                <div className="text-sm text-gray-600 mb-3 pb-2 border-b">
                  <strong>ì œëª©:</strong> [SIO] ìƒì‚°íŒ€ ë¯¸ì¡°ì¹˜ ì‚¬í•­ 2ê±´ ì•Œë¦¼
                </div>
                <pre className="whitespace-pre-wrap text-sm text-gray-700 font-sans leading-relaxed">{`ì•ˆë…•í•˜ì„¸ìš”,

í˜„ì¬ ìƒì‚°íŒ€ì— í• ë‹¹ëœ ë¯¸ì¡°ì¹˜ SIOê°€ 2ê±´ ìˆìŠµë‹ˆë‹¤.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. [2024/1/15] ìƒì‚°1ë¼ì¸
   êµ¬ë¶„: ì•ˆì „ | ìƒíƒœ: ì ‘ìˆ˜ì™„ë£Œ
   ë‚´ìš©: ë°”ë‹¥ ë¯¸ë„ëŸ¬ì›€ ë°œìƒ

2. [2024/1/14] ì°½ê³ 
   êµ¬ë¶„: í™˜ê²½ | ìƒíƒœ: ì¡°ì¹˜ì¤‘
   ë‚´ìš©: ì¡°ëª… ë¶ˆëŸ‰

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SIO ì‹œìŠ¤í…œì—ì„œ í™•ì¸ ë° ì¡°ì¹˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ê°ì‚¬í•©ë‹ˆë‹¤.`}</pre>
              </div>
            )}

            <p className="text-sm text-gray-500 mb-4">ë¯¸ì¡°ì¹˜ ì‚¬í•­ì´ ìˆëŠ” ë¶€ì„œì— ìœ„ í˜•ì‹ì˜ ì´ë©”ì¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.</p>
          </div>

          {/* ì €ì¥ & ë°œì†¡ ë²„íŠ¼ */}
          <div className="flex gap-2">
            <button onClick={saveSettings} className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center gap-2">
              <Icon name="Save" size={18} /> ì„¤ì • ì €ì¥
            </button>
            <button onClick={sendNotifications} className="flex-1 py-3 bg-orange-500 text-white rounded-lg font-medium hover:bg-orange-600 flex items-center justify-center gap-2">
              <Icon name="Send" size={18} /> ì•Œë¦¼ ë°œì†¡
            </button>
          </div>

          {/* ëª©ë¡ ê´€ë¦¬ */}
          {sections.map(({ key, label }) => (
            <div key={key} className="bg-white rounded-xl shadow-md p-4">
              <h3 className="font-bold text-gray-700 mb-3">{label} ëª©ë¡</h3>
              <div className="flex gap-2 mb-3">
                <input type="text" value={newItem[key]} onChange={(e) => setNewItem({ ...newItem, [key]: e.target.value })}
                  className="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder={`ìƒˆ ${label} ì¶”ê°€`}
                  onKeyPress={(e) => e.key === 'Enter' && addItem(key)} />
                <button onClick={() => addItem(key)} className="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700"><Icon name="Plus" size={20} /></button>
              </div>
              <div className="space-y-2">
                {settings[key].map((item, idx) => (
                  <div key={idx} className="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                    <span className="text-sm text-gray-700">{item}</span>
                    <button onClick={() => removeItem(key, idx)} className="text-red-400 hover:text-red-600"><Icon name="Trash2" size={16} /></button>
                  </div>
                ))}
              </div>
            </div>
          ))}

          {alertModal && <AlertModal message={alertModal.message} type={alertModal.type} onClose={() => setAlertModal(null)} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
